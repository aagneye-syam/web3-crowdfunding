"use strict";
"use client";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConnectModalContent = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const useSiweAuth_js_1 = require("../../../../core/hooks/auth/useSiweAuth.js");
const useWalletConnectionCtx_js_1 = require("../../../../core/hooks/others/useWalletConnectionCtx.js");
const wallet_hooks_js_1 = require("../../../../core/hooks/wallets/wallet-hooks.js");
const wallet_ui_states_provider_js_1 = require("../../../providers/wallet-ui-states-provider.js");
const LoadingScreen_js_1 = require("../../../wallets/shared/LoadingScreen.js");
const WalletSelector_js_1 = require("../WalletSelector.js");
const constants_js_1 = require("../constants.js");
const SignatureScreen_js_1 = require("../screens/SignatureScreen.js");
const StartScreen_js_1 = require("../screens/StartScreen.js");
const AnyWalletConnectUI_js_1 = require("./AnyWalletConnectUI.js");
const ConnectModalSkeleton_js_1 = require("./ConnectModalSkeleton.js");
const SmartWalletConnectUI_js_1 = require("./SmartWalletConnectUI.js");
const screen_js_1 = require("./screen.js");
const AllWalletsUI = /* @__PURE__ */ (0, react_1.lazy)(() => Promise.resolve().then(() => require("./AllWalletsUI.js")));
/**
 * @internal
 */
const ConnectModalContent = (props) => {
    const { setModalVisibility, onClose } = props;
    const { screen, setScreen, initialScreen } = props.screenSetup;
    const { wallets, accountAbstraction, auth, onConnect, connectModal, connectLocale, client, } = (0, useWalletConnectionCtx_js_1.useConnectUI)();
    const setActiveWallet = (0, wallet_hooks_js_1.useSetActiveWallet)();
    const setSelectionData = (0, wallet_ui_states_provider_js_1.useSetSelectionData)();
    const siweAuth = (0, useSiweAuth_js_1.useSiweAuth)(auth);
    const showSignatureScreen = siweAuth.requiresAuth && !siweAuth.isLoggedIn;
    const handleConnected = (0, react_1.useCallback)((wallet) => {
        setActiveWallet(wallet);
        if (onConnect) {
            onConnect(wallet);
        }
        (0, constants_js_1.onModalUnmount)(() => {
            setSelectionData({});
            setModalVisibility(true);
        });
        // show sign in screen if required
        if (showSignatureScreen) {
            setScreen(constants_js_1.reservedScreens.signIn);
        }
        else {
            onClose();
        }
    }, [
        setModalVisibility,
        onClose,
        onConnect,
        setActiveWallet,
        showSignatureScreen,
        setScreen,
        setSelectionData,
    ]);
    const handleBack = (0, react_1.useCallback)(() => {
        setScreen(initialScreen);
    }, [setScreen, initialScreen]);
    const walletList = ((0, jsx_runtime_1.jsx)(WalletSelector_js_1.WalletSelector, { title: connectModal.title || connectLocale.defaultModalTitle, wallets: wallets, onGetStarted: () => {
            setScreen(constants_js_1.reservedScreens.getStarted);
        }, selectWallet: setScreen, onShowAll: () => {
            setScreen(constants_js_1.reservedScreens.showAll);
        }, done: handleConnected, goBack: wallets.length > 1 ? handleBack : undefined, setModalVisibility: setModalVisibility }));
    const showAll = ((0, jsx_runtime_1.jsx)(react_1.Suspense, { fallback: (0, jsx_runtime_1.jsx)(LoadingScreen_js_1.LoadingScreen, {}), children: (0, jsx_runtime_1.jsx)(AllWalletsUI, { onBack: handleBack, onSelect: setScreen }) }));
    const getStarted = (0, jsx_runtime_1.jsx)(StartScreen_js_1.StartScreen, {});
    const goBack = wallets.length > 1 ? handleBack : undefined;
    const getWalletUI = (wallet) => {
        if (accountAbstraction) {
            return ((0, jsx_runtime_1.jsx)(SmartWalletConnectUI_js_1.SmartConnectUI, { accountAbstraction: accountAbstraction, done: (smartWallet) => {
                    handleConnected(smartWallet);
                }, personalWallet: wallet, onBack: goBack, setModalVisibility: props.setModalVisibility }, wallet.id));
        }
        return ((0, jsx_runtime_1.jsx)(AnyWalletConnectUI_js_1.AnyWalletConnectUI, { wallet: wallet, onBack: goBack, done: () => {
                handleConnected(wallet);
            }, setModalVisibility: props.setModalVisibility }, wallet.id));
    };
    const signatureScreen = ((0, jsx_runtime_1.jsx)(SignatureScreen_js_1.SignatureScreen, { onDone: onClose, modalSize: connectModal.size, termsOfServiceUrl: connectModal.termsOfServiceUrl, privacyPolicyUrl: connectModal.privacyPolicyUrl, auth: auth, client: client, connectLocale: connectLocale }));
    return ((0, jsx_runtime_1.jsx)(screen_js_1.ScreenSetupContext.Provider, { value: props.screenSetup, children: connectModal.size === "wide" ? ((0, jsx_runtime_1.jsx)(ConnectModalSkeleton_js_1.ConnectModalWideLayout, { left: walletList, right: (0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [screen === constants_js_1.reservedScreens.signIn && signatureScreen, screen === constants_js_1.reservedScreens.main && getStarted, screen === constants_js_1.reservedScreens.getStarted && getStarted, screen === constants_js_1.reservedScreens.showAll && showAll, typeof screen !== "string" && getWalletUI(screen)] }) })) : ((0, jsx_runtime_1.jsxs)(ConnectModalSkeleton_js_1.ConnectModalCompactLayout, { children: [screen === constants_js_1.reservedScreens.signIn && signatureScreen, screen === constants_js_1.reservedScreens.main && walletList, screen === constants_js_1.reservedScreens.getStarted && getStarted, screen === constants_js_1.reservedScreens.showAll && showAll, typeof screen !== "string" && getWalletUI(screen)] })) }));
};
exports.ConnectModalContent = ConnectModalContent;
//# sourceMappingURL=ConnectModalContent.js.map