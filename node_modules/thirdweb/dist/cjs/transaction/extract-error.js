"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.__DEV__ = exports.extractError = void 0;
const viem_1 = require("viem");
const resolve_abi_js_1 = require("../contract/actions/resolve-abi.js");
/**
 * @internal
 */
async function extractError(args) {
    const { error, contract } = args;
    if (typeof error === "object") {
        // try to parse RPC error
        const errorObj = error;
        if (errorObj.data) {
            if (errorObj.data !== "0x") {
                let abi = contract?.abi;
                if (contract && !abi) {
                    abi = await (0, resolve_abi_js_1.resolveContractAbi)(contract).catch(() => undefined);
                }
                const parsedError = (0, viem_1.decodeErrorResult)({
                    data: errorObj.data,
                    abi,
                });
                return new TransactionError(`${parsedError.errorName}${parsedError.args ? ` - ${parsedError.args}` : ""}`, contract);
            }
            return new TransactionError("Execution Reverted", contract);
        }
    }
    return error;
}
exports.extractError = extractError;
exports.__DEV__ = process.env.NODE_ENV !== "production";
class TransactionError extends Error {
    constructor(reason, contract) {
        super();
        Object.defineProperty(this, "contractAddress", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "chainId", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        this.name = "TransactionError";
        this.contractAddress = contract?.address;
        this.chainId = contract?.chain?.id;
        if (exports.__DEV__ && contract) {
            // show more infor in dev
            this.message = [
                reason,
                "",
                `contract: ${this.contractAddress}`,
                `chainId: ${this.chainId}`,
            ].join("\n");
        }
        else {
            this.message = reason;
        }
    }
}
//# sourceMappingURL=extract-error.js.map